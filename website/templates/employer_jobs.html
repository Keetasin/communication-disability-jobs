{% extends 'base.html' %}

{% block title %}
    งานของฉัน - Communication Disability Jobs
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="employer-jobs-container fade-in">
        <!-- Header -->
        <div class="page-header">
            <div class="header-content">
                <h2><i class="fa fa-briefcase"></i> งานที่คุณโพสต์</h2>
                <p>จัดการงานและติดตามผู้สมัคร</p>
            </div>
            <div class="header-actions">
                <a href="/post-job" class="btn btn-success">
                    <i class="fa fa-plus"></i> โพสต์งานใหม่
                </a>
            </div>
        </div>

        {% if jobs %}
            <!-- Jobs List -->
            <div class="jobs-list">
                {% for job in jobs %}
                <div class="job-item hover-lift">
                    <!-- Job Header -->
                    <div class="job-header">
                        <div class="job-info">
                            <h4 class="job-title">{{ job.title }}</h4>
                            <div class="job-meta">
                                <span class="meta-item">
                                    <i class="fa fa-calendar"></i>
                                    โพสต์เมื่อ: {{ job.posted_at.strftime('%d/%m/%Y') }}
                                </span>
                                {% if job.location %}
                                <span class="meta-item">
                                    <i class="fa fa-map-marker"></i>
                                    {{ job.location }}
                                </span>
                                {% endif %}
                                {% if job.salary %}
                                <span class="meta-item">
                                    <i class="fa fa-money"></i>
                                    {{ job.salary }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="job-actions">
                            <a href="{{ url_for('views.post_job', job_id=job.id) }}" 
                               class="btn btn-outline-warning btn-sm">
                                <i class="fa fa-edit"></i> แก้ไข
                            </a>
                            <button class="btn btn-outline-danger btn-sm" 
                                    onclick="confirmDelete({{ job.id }}, '{{ job.title }}')">
                                <i class="fa fa-trash"></i> ลบ
                            </button>
                        </div>
                    </div>

                    <!-- Job Description -->
                    <div class="job-description">
                        {{ job.description[:200] }}{% if job.description|length > 200 %}...{% endif %}
                    </div>

                    <!-- Applications Section -->
                    <div class="applications-section">
                        <h5>
                            <i class="fa fa-users"></i> 
                            ผู้สมัครงาน ({{ job.applications|length }} คน)
                        </h5>
                        
                        {% if job.applications %}
                            <div class="applicants-grid">
                                {% for app in job.applications %}
                                <div class="applicant-card">
                                    <div class="applicant-info">
                                        <div class="applicant-avatar">
                                            <i class="fa fa-user-circle"></i>
                                        </div>
                                        <div class="applicant-details">
                                            <h6>{{ app.applicant.first_name }} {{ app.applicant.last_name }}</h6>
                                            <p class="applicant-email">{{ app.applicant.email }}</p>
                                            <small class="apply-date">
                                                สมัครเมื่อ: {{ app.applied_at.strftime('%d/%m/%Y %H:%M') }}
                                            </small>
                                        </div>
                                    </div>
                                    
                                    <div class="applicant-status">
                                        {% if app.status == 'accepted' %}
                                            <span class="status-badge status-accepted">
                                                <i class="fa fa-check-circle"></i> รับเข้าทำงานแล้ว
                                            </span>
                                        {% else %}
                                            <span class="status-badge status-pending">
                                                <i class="fa fa-clock-o"></i> รอการพิจารณา
                                            </span>
                                        {% endif %}
                                    </div>

                                    <div class="applicant-actions">
                                        <a href="{{ url_for('views.view_applicant', application_id=app.id) }}" 
                                           class="btn btn-outline-info btn-sm">
                                            <i class="fa fa-eye"></i> ดูรายละเอียด
                                        </a>
                                        
                                        {% if app.status != 'accepted' %}
                                            <form method="POST" action="{{ url_for('views.accept_applicant', application_id=app.id) }}" 
                                                  style="display: inline;" class="accept-form">
                                                <button type="submit" class="btn btn-success btn-sm">
                                                    <i class="fa fa-check"></i> ตอบรับ
                                                </button>
                                            </form>
                                        {% endif %}

                                        <a href="{{ url_for('views.chat', application_id=app.id) }}" 
                                           class="btn btn-outline-primary btn-sm">
                                            <i class="fa fa-comments"></i> แชท
                                        </a>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="no-applicants">
                                <i class="fa fa-inbox"></i>
                                <p>ยังไม่มีผู้สมัครงานนี้</p>
                                <small>แชร์ลิงก์งานหรือรอผู้สมัครที่เหมาะสม</small>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

        {% else %}
            <!-- Empty State -->
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fa fa-briefcase"></i>
                </div>
                <h3>ยังไม่มีงานที่โพสต์</h3>
                <p>เริ่มต้นสร้างประกาศรับสมัครงานแรกของคุณ</p>
                <a href="/post-job" class="btn btn-primary btn-lg">
                    <i class="fa fa-plus"></i> โพสต์งานแรก
                </a>
            </div>
        {% endif %}
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fa fa-warning"></i> ยืนยันการลบ
                </h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>คุณแน่ใจหรือไม่ว่าต้องการลบงาน "<span id="jobTitle"></span>"?</p>
                <div class="alert alert-warning">
                    <i class="fa fa-exclamation-triangle"></i>
                    การลบจะไม่สามารถยกเลิกได้ และจะลบข้อมูลผู้สมัครที่เกี่ยวข้องด้วย
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">ยกเลิก</button>
                <form id="deleteForm" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        <i class="fa fa-trash"></i> ลบงาน
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Accept application handling
    const acceptForms = document.querySelectorAll('.accept-form');
    acceptForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const btn = this.querySelector('button');
            btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> กำลังตอบรับ...';
            btn.disabled = true;
        });
    });

    // Animation
    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.fade-in, .job-item').forEach(el => {
        observer.observe(el);
    });
});

// Delete confirmation
function confirmDelete(jobId, jobTitle) {
    document.getElementById('jobTitle').textContent = jobTitle;
    document.getElementById('deleteForm').action = `/delete-job/${jobId}`;
    $('#deleteModal').modal('show');
}
</script>

<style>
/* Employer Jobs Styles */
.employer-jobs-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
}

.page-header {
    background: linear-gradient(135deg, var(--primary-blue), var(--light-blue));
    color: var(--pure-white);
    padding: 2rem;
    border-radius: var(--border-radius-lg);
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.page-header h2 {
    color: var(--pure-white);
    margin-bottom: 0.5rem;
}

.page-header p {
    margin: 0;
    opacity: 0.9;
}

.jobs-list {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.job-item {
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 123, 255, 0.1);
    border-radius: var(--border-radius-lg);
    padding: 2rem;
    box-shadow: var(--shadow-light);
    transition: var(--transition-normal);
}

.job-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--light-gray);
}

.job-title {
    color: var(--dark-blue);
    font-size: 1.4rem;
    font-weight: var(--font-weight-semibold);
    margin-bottom: 0.5rem;
}

.job-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    color: var(--medium-gray);
}

.meta-item i {
    color: var(--primary-blue);
    width: 16px;
}

.job-actions {
    display: flex;
    gap: 0.5rem;
}

.job-description {
    color: var(--dark-gray);
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.applications-section {
    border-top: 1px solid var(--light-gray);
    padding-top: 1.5rem;
}

.applications-section h5 {
    color: var(--dark-blue);
    margin-bottom: 1rem;
}

.applicants-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1rem;
}

.applicant-card {
    background: rgba(0, 123, 255, 0.03);
    border: 1px solid rgba(0, 123, 255, 0.1);
    border-radius: var(--border-radius-md);
    padding: 1rem;
    transition: var(--transition-normal);
}

.applicant-card:hover {
    background: rgba(0, 123, 255, 0.05);
    border-color: var(--primary-blue);
}

.applicant-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.applicant-avatar {
    font-size: 2rem;
    color: var(--primary-blue);
}

.applicant-details h6 {
    color: var(--dark-blue);
    margin-bottom: 0.25rem;
}

.applicant-email {
    color: var(--medium-gray);
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
}

.apply-date {
    color: var(--medium-gray);
    font-size: 0.8rem;
}

.applicant-status {
    margin-bottom: 1rem;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.25rem 0.75rem;
    border-radius: var(--border-radius-sm);
    font-size: 0.85rem;
    font-weight: var(--font-weight-medium);
}

.status-accepted {
    background: rgba(40, 167, 69, 0.1);
    color: var(--success-green);
    border: 1px solid rgba(40, 167, 69, 0.3);
}

.status-pending {
    background: rgba(255, 193, 7, 0.1);
    color: #856404;
    border: 1px solid rgba(255, 193, 7, 0.3);
}

.applicant-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.applicant-actions .btn {
    font-size: 0.8rem;
    padding: 0.25rem 0.5rem;
}

.no-applicants {
    text-align: center;
    padding: 2rem;
    color: var(--medium-gray);
}

.no-applicants i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.no-applicants p {
    margin-bottom: 0.5rem;
    font-weight: var(--font-weight-medium);
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: rgba(255, 255, 255, 0.9);
    border-radius: var(--border-radius-lg);
    border: 2px dashed rgba(0, 123, 255, 0.3);
}

.empty-icon {
    font-size: 4rem;
    color: var(--primary-blue);
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-state h3 {
    color: var(--dark-blue);
    margin-bottom: 1rem;
}

.empty-state p {
    color: var(--medium-gray);
    margin-bottom: 2rem;
}

/* Modal Styles */
.modal-header {
    background: linear-gradient(135deg, var(--danger-red), #ff6b6b);
    color: var(--pure-white);
    border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
}

.alert-warning {
    background: rgba(255, 193, 7, 0.1);
    border: 1px solid rgba(255, 193, 7, 0.3);
    color: #856404;
}

/* Responsive */
@media (max-width: 768px) {
    .page-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .job-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
    
    .job-actions {
        width: 100%;
        justify-content: flex-start;
    }
    
    .applicants-grid {
        grid-template-columns: 1fr;
    }
    
    .applicant-info {
        flex-direction: column;
        text-align: center;
    }
    
    .applicant-actions {
        justify-content: center;
    }
}
</style>
{% endblock %}